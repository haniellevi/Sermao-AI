Esta √© a parte que voc√™ construir√° dinamicamente no seu c√≥digo Python (no Replit, dentro da fun√ß√£o generateSermonWithAI). A user message cont√©m os dados espec√≠ficos da requisi√ß√£o do usu√°rio, incluindo o contexto do RAG e o formato de sa√≠da desejado.

Python

# backend/app/services.py (dentro de generateSermonWithAI)

# ... (L√≥gica de infer√™ncia de par√¢metros, busca de vers√≠culos, RECUPERA√á√ÉO RAG, etc.) ...

# Constru√ß√£o da mensagem do usu√°rio
userMessageContent = f"""
---
## ‚öôÔ∏è Modo Operacional para ESTE SERM√ÉO ESPEC√çFICO:

1.  **Par√¢metros do Serm√£o (Fornecidos/Inferidos):**
    -   Tema: {inferredTheme}
    -   Prop√≥sito: {inferredPurpose}
    -   P√∫blico-alvo: {inferredAudience}
    -   Dura√ß√£o Solicitada: {inferredDuration} (ADAPTE O VOLUME DE CONTE√öDO, DETALHE, N√öMERO DE PONTOS E PROFUNDIDADE DE EXPLANA√á√ÉO PARA ATINGIR ESTA DURA√á√ÉO. Considere 120-150 palavras por minuto.)
    -   Estilo: {inferredStyle}
    -   Contexto: {inferredContext}
    -   Vers√≠culos B√≠blicos Selecionados: {", ".join(bibleVerses) if bibleVerses else "Nenhum"}
    -   Insights de Serm√µes de Refer√™ncia: {referenceInsights} (Se URLs de refer√™ncia foram processadas e resumidas.)

2.  **DNA do Pregador (Perfil Completo):**
    {dnaContext}

3.  **Contexto Adicional de Coment√°rios B√≠blicos (RAG):**
    Use este contexto, recuperado de suas fontes de refer√™ncia, para aprofundar e enriquecer o serm√£o. **Priorize esta informa√ß√£o para precis√£o e detalhes factuais/teol√≥gicos.**
    {retrievedContext}

---
## üìù Formato de Resposta (JSON - ESTRICTAMENTE NESTE FORMATO):

Retorne APENAS o JSON, sem texto adicional antes ou depois.

{{
  "serm√£o": "Texto completo do serm√£o gerado, **J√Å FORMATADO em LINGUAGEM NATURAL, como um post de blog**. Utilize t√≠tulos, subt√≠tulos, par√°grafos espa√ßados, e uso estrat√©gico de negrito/it√°lico para m√°xima legibilidade e impacto. Exemplos de formata√ß√£o: \\n\\n## T√≠tulo do Serm√£o: A Esperan√ßa que Transforma\\n\\n### Introdu√ß√£o: Onde Encontramos Ref√∫gio?\\n\\n[Primeiro par√°grafo da introdu√ß√£o...]\\n\\n### Ponto 1: A Natureza da Verdadeira Esperan√ßa\\n\\n**Hebreus 11:1** - _'Ora, a f√© √© a certeza daquilo que esperamos e a prova das coisas que n√£o vemos.'_\\n\\n[Explana√ß√£o do ponto...]\\n\\n### Conclus√£o: Uma Chamada √† A√ß√£o Transformadora\\n\\n[√öltimo par√°grafo da conclus√£o...]",
  "sugestoes_enriquecimento": [
    "Sugest√£o 1: Descri√ß√£o da ilustra√ß√£o/met√°fora/din√¢mica.",
    "Sugest√£o 2: Descri√ß√£o da ilustra√ß√£o/met√°fora/din√¢mica."
  ],
  "avaliacao_qualidade": {
    "nota": "N√∫mero de 0 a 10, pode ser decimal (ex: 9.2)",
    "justificativa": "Breve texto com pontos fortes e sugest√µes de melhoria."
  }
}}
"""

# --- CONSTRU√á√ÉO FINAL DAS MENSAGENS PARA O GEMINI ---
messagesForGemini = [
    {"role": "system", "parts": [{"text": systemPromptContent}]},
    {"role": "user", "parts": [{"text": userMessageContent}]}
]

# ... (Restante da chamada para callGeminiChatModel) ...